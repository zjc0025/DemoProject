<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!--jQuery js-->
    <script src="../../resources/js/boot.js" type="text/javascript"></script>


    <style type="text/css">
        .errorText
        {
            color:red;
        }
    </style>


</head>
<body>

<div id="loginWindow" class="mini-window" title="用户登录" style="width:350px;height:170px;"
     showModal="true" showCloseButton="false"
>

    <div id="loginForm" style="padding:15px;padding-top:10px;">
        <table >
            <tr>
                <td style="width:60px;"><label for="username$text">帐号：</label></td>
                <td>
                    <input id="username" name="userName" onvalidation="onUserNameValidation" class="mini-textbox" required="true" style="width:150px;"/>
                </td>
            </tr>
            <tr>
                <td style="width:60px;"><label for="pwd$text">密码：</label></td>
                <td>
                    <input id="pwd" name="password" onvalidation="onPwdValidation" class="mini-password" requiredErrorText="密码不能为空" required="true" style="width:150px;" onenter="onLoginClick"/>
                </td>
            </tr>
            <tr>
                <td></td>
                <td style="padding-top:5px;">
                    <a onclick="onLoginClick" class="mini-button" style="width:60px;">登录</a>
                    <a onclick="onResetClick" class="mini-button" style="width:60px;">重置</a>
                </td>
            </tr>
        </table>
    </div>

</div>

<script type="text/javascript">
    mini.parse();

    var loginWindow = mini.get("loginWindow");
    loginWindow.show();

    function onLoginClick(e) {

        var form = new mini.Form("#loginWindow");

        var data = form.getData();      //获取表单多个控件的数据
        var json = mini.encode(data);   //序列化成JSON
        $.ajax({
            url: "/user/login2",
            type: "post",
            data: json,
            // dataType:"json",
            contentType:'application/json; charset=utf-8',
            async:false,
            success: function (text) {
                if(text == "true"){
                    loginWindow.hide();
                    mini.loading("登录成功，请稍后...", "登录成功");
                    setTimeout(function () {
                        window.location = "home.html";
                    }, 700);
                }else if(text == "false"){
                    location.reload();
                }
            }
        });

        // form.validate();
        // if (form.isValid() == false) return;

        // loginWindow.hide();
        // mini.loading("登录成功，马上转到系统...", "登录成功");
        // setTimeout(function () {
        //     window.location = "../outlooktree/outlooktree.txt";
        // }, 1500);
    }
    function onResetClick(e) {
        var form = new mini.Form("#loginWindow");
        form.clear();
    }
    /////////////////////////////////////

    function onUserNameValidation(e) {
        // if (e.isValid) {
        //     if (isEmail(e.value) == false) {
        //         e.errorText = "必须输入邮件地址";
        //         e.isValid = false;
        //     }
        // }
    }
    function onPwdValidation(e) {
        // if (e.isValid) {
        //     if (e.value.length < 5) {
        //         e.errorText = "密码不能少于5个字符";
        //         e.isValid = false;
        //     }
        // }
    }
</script>

</body>
</html>


